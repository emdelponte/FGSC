---
title: "Global Fusarium graminearum Database"
output: 
  flexdashboard::flex_dashboard:
    theme: united
    css: style2.css
    social: menu
---



```{r setup, include=FALSE}

library(flexdashboard)
library(readxl)
library(tidyverse)
library(crosstalk)
library(plotly)
library(viridis)
```



```{r load data, include=FALSE}
Sys.setlocale("LC_ALL", 'pt_BR.UTF-8')
# carrega os dados com lat e long
fgsc2 <- read_excel("fgsc-dat2.xlsx", 3)
fgsc21 <- read_excel("fgsc-dat2.xlsx", 2)
fgsc22 <- read_excel("fgsc-dat2.xlsx", 4)
fgsc23 <- read_excel("fgsc-dat2.xlsx", 5)
fgsc24 <- read_excel("fgsc-dat2.xlsx", 6)
fgsc25 <- read_excel("fgsc-dat2.xlsx", 7)
fgsc26 <- read_excel("fgsc-dat2.xlsx", 8)
fgsc29 <- read_excel("fgsc-dat2.xlsx", 9)
fgsc210 <- read_excel("fgsc-dat2.xlsx", 10)
fgsc2 <- rbind(fgsc2, fgsc21, fgsc22, fgsc23, fgsc24, fgsc25, fgsc26, fgsc29, fgsc210)
fgsc2$Latitude <- round(jitter(fgsc2$Latitude, factor = 6),4)
fgsc2$Longitude <- round(jitter(fgsc2$Longitude, factor = 6),4)


fgsc <- fgsc2 %>% select(c(1,2, 6,7, 8,9, 10, 14, 19, 20, 21))
library(plyr)
fgsc$FGSC <- revalue(fgsc$FGSC, c("F. graminearum" = "Fgra",
                                  "F. meridionale" = "Fmer",
                                  "F. cortaderiae" = "Fcor",
                                  "F. austroamericanum" = "Faus",
                                  "F. asiaticum" = "Fasi"
                                  ))

```



```{r all table, echo=FALSE}
library(crosstalk)
library(leaflet)
library(DT)
sd <- SharedData$new(fgsc)
sd2 <- SharedData$new(fgsc2)
```

Main dashboard
==================


Column {}
----------------------------------


### Filters


**Welcome!**  to the **Global *Fusarium graminearum* species complex (FGSC) database**, a curated collection of information on strains isolated from different hosts and which were identified to phylogenetic species and reported in peer-reviewed scientific articles. Apply the filters below to update the table, the plot and map according to selected fields. Use backspace to clean up your search and start again. Use the search field in the table below for quick browsing.


<table class= "table">
<tr>
<td width=50%>

```{r}
filter_select("Pub1", "Select article(s)", sd, ~Pub1)
filter_select("Country", "Select Country", sd, ~Country)
```

</td><td>
```{r}

filter_select("Host", "Host", sd, ~Host)
filter_select("Tri_genotype", "Select genotype(s)", sd, ~Tri_genotype)
#filter_select("FGSC", "Species", sd, ~FGSC)
```

</td></tr></table>





### <i aria-hidden="true"></i> Table




```{r}
datatable(sd, 
          extensions = c('Buttons', 'ColReorder'),
          escape = TRUE,
          rownames = FALSE, 
          colnames = c('ID', 'Host', 'Country', 'Year', 'Lat', 'Long', 'FGSC', 'Tri genotype', 'Pub1'), 
         class = 'cell-border stripe',
                      options=list(dom = 'Bfrtip',
                                   buttons = c( 'excel', 'pdf'), deferRender=TRUE, 
                         scrollY='520px', 
                         scroller=TRUE,
                          colReorder = F,
                         
  pageLength = 50,
    fontSize = 8,
  lengthMenu = c(100, 250, 500))) %>% 
 formatStyle(
  c('ID', 'Host', 'Country', 'Year', 'Latitude', 'Longitude', 'FGSC', 'Tri_genotype', 'Pub1'),
  fontSize = '90%')
```



Column {data-width=400}
----------------------------------

###  <i class="fa fa-map" aria-hidden="true"></i> Map of isolates

```{r}
library(viridis)

pal <- colorFactor("viridis", domain = c("Fgra", "Fmer", "Fasi", "Fcor", "F. aus"))

library(magrittr)
leaflet(sd) %>% 
  setView(-49.65, -1.0285, zoom = 2) %>% 
  addProviderTiles(providers$OpenStreetMap.Mapnik)   %>%
   addTiles() %>% 
  addCircleMarkers(group = "Species", color = NA, fillColor = ~pal(FGSC), radius = 5, fillOpacity = 0.9) %>% 
addLegend("bottomright", pal = pal, values = ~FGSC, title = "Species",  opacity = 1) %>%  
addEasyButton(easyButton(
    icon="fa-globe", title="Back to initial view",
    onClick=JS("function(btn, map){ map.setZoom(2); }"))) 

```




### <i class="fa fa-bar-chart" aria-hidden="true"></i> Trichothecene genotype frequency plot


```{r}

#fgsc$FGSC2 <- with(fgsc, reorder(FGSC, FGSC, function(x) length(x)))
#p<-sd %>% 
# ggplot(aes(FGSC))+
# geom_bar(aes(fill = Tri_genotype)) +
# theme_grey() +
# scale_fill_viridis(discrete = TRUE)+
# coord_flip()+
# theme(legend.position = "bottom", panel.background = element_rect(fill = "grey97"))+
# labs(fill = "Tri genotype", y = "Frequency", x = "", title = "")
#(gg <- ggplotly(p))


sd %>% 
  plot_ly(x = ~Tri_genotype, 
         color=~Tri_genotype,
      
          colors = viridis_pal(option = "D")(3)) %>% 
  layout(barmode = 'stack',
         margin=list(l=40,r=40,t=40,b=40))

 #add_trace(x = ~FGSC)


```









<i class="fa fa-table" aria-hidden="true"></i> Full table
===========
```{r}
datatable(fgsc2, 
          extensions = c('Buttons', 'ColReorder'),
          escape = TRUE, rownames = FALSE,
         class = 'cell-border stripe',
                      options=list(dom = 'Bfrtip',buttons = c( 'excel', 'pdf'),deferRender=TRUE, 
                          scrollY=500, 
                          scroller=TRUE,
                          colReorder = TRUE,
  pageLength = 100,
    fontSize = 8,
  lengthMenu = c(100, 250, 500))) %>% 
formatStyle(c(1:19),
  fontSize = '90%')
```


<i class="fa fa-map" aria-hidden="true"></i> Full page map 
============



Column {data-width=100}
----------------------------------

### Quick filter

```{r}
filter_checkbox("Tri_genotype", "Tricothecene genotype", sd, ~Tri_genotype, inline = FALSE)

filter_checkbox("Host", "Host", sd, ~Host, inline = FALSE)

```



Column {.tabset tabset-fade}
----------------------------------



### Full map


```{r}



library(htmltools)
pal <- colorFactor("viridis", domain = c("Fgra", "Fmer", "Fasi", "Fcor", "Faus"))
leaflet(data = sd) %>%
 setView(-49.65, -25.0285, zoom = 3) %>% 
 addProviderTiles(providers$OpenStreetMap.Mapnik)  %>% 
    addCircleMarkers(group = "FGSC", radius = 7, fillOpacity = 0.8,  weight=1, color = NA, fillColor = ~pal(FGSC), label = ~Tri_genotype) %>%
addLegend("topright", pal = pal, values = ~FGSC, title = "Species",  opacity = 1 ) %>%   
 addEasyButton(easyButton(
    icon="fa-globe", title="Back to initial view",
    onClick=JS("function(btn, map){ map.setZoom(5); }"))) 


```


About the database 
============


Column {.tabset}
----------------------------------

### About

### References


