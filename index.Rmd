---
title: "Global Fusarium graminearum Database"
output: 
  flexdashboard::flex_dashboard:
    theme: united
    css: style2.css
    social: menu
editor_options: 
  chunk_output_type: inline
---



```{r setup, include=FALSE}

library(flexdashboard)
library(readxl)
library(tidyverse)
library(crosstalk)
library(plotly)
library(viridis)
```



```{r load data, message=FALSE, warning=FALSE, include=FALSE}
Sys.setlocale("LC_ALL", 'pt_BR.UTF-8')

fgsc <- read_excel("fgsc-dat5.xlsx")
fgsc <- fgsc %>% 
  filter(TRI_genotype != "15-ADON, NIV")
library(plyr)
fgsc$FGSC <- revalue(fgsc$FGSC, 
                     c("Fusarium vorosii" = "F. vorosii",
                       "Fusarium nepalense" = "F. nepalense",
                       "Fusarium meridionale" = "F. meridionale",
                       "Fusarium graminearum" = "F. graminearum",
                       "Fusarium cortaderiae" = "F. cortaderiae",
                       "Fusarium boothii" = "F. boothii",
                      "Fusarium asiaticum" = "F. asiaticum"))

fgsc$TRI_genotype <- revalue(fgsc$TRI_genotype, 
                     c("DON/ZEA" = "DON",
                       "N-15-ADON" = "15-ADON",
                       "N-15ADON" = "15-ADON",
                       "s3-ADON" = "3-ADON",
                       "NX-2/3-ADON" = "NX-2",
                       "NX2" = "NX-2"))                       


```



```{r all table, echo=FALSE}
library(crosstalk)
library(leaflet)
library(leaflet.extras)
library(DT)
sd <- SharedData$new(fgsc)

```




<i class="fa fa-map" aria-hidden="true"></i> Map and chart
============



Column {data-width=230}
----------------------------------

### Quick filter


```{r}
filter_slider("Year", "Year of isolation", sd, ~Year)
filter_select("Pub1", "Select article(s)", sd, ~Pub1)
filter_select("Country", "Select Country", sd, ~Country)
```


```{r}
filter_select("Host", "Host", sd, ~Host)
filter_select("FGSC", "Species", sd, ~FGSC)
filter_select("TRI_genotype", "Select genotype(s)", sd, ~TRI_genotype)
```


<input type="button" value="Clean all filters" onClick="window.location.reload()">



Column {.tabset}
----------------------------------



### <i class="fa fa-map" aria-hidden="true"></i> Tri genotype map


```{r}
library(RColorBrewer)
library(htmltools)
pal <- colorFactor("RdYlBu", domain = c("15-ADON", "3-ADON", "DON", "NIV", "DON/NIV",  "NX-2", "NA"))
leaflet(data = sd) %>%
addTiles() %>% 

  addCircleMarkers(group = "TRI_genotype", radius = 3, fillOpacity = 0.8,  weight=0.5, color = NA, fillColor = ~pal(TRI_genotype), label = paste(fgsc$FGSC,"- click for details"), popup = paste("Collection code:<b>", fgsc$`Collection code`, "</b>", "<br><i>", fgsc$FGSC,"</i>(", fgsc$TRI_genotype, ")<br>", "Host:", fgsc$Host,"<br>","Location:", fgsc$Country, "<br>","Year of collection:", fgsc$Year, "<br>","Reference:", fgsc$Pub1))%>%
addLegend("bottomleft", pal = pal, values = ~TRI_genotype, title = "TRI genotype",  opacity = 1 )%>%   
  addMiniMap() %>% 
 addEasyButton(easyButton(
    icon="fa-globe", title="Back to initial view",
    onClick=JS("function(btn, map){ map.setZoom(2); }"))) 


```





### <i class="fa fa-bar-chart" aria-hidden="true"></i> TRI genotype by species 

dfa
```{r}

#fgsc$FGSC2 <- with(fgsc, reorder(FGSC, FGSC, function(x) length(x)))
#p<-sd %>% 
# ggplot(aes(FGSC))+
# geom_bar(aes(fill = TRI_genotype)) +
# theme_grey() +
# scale_fill_viridis(discrete = TRUE)+
# coord_flip()+
# theme(legend.position = "bottom", panel.background = element_rect(fill = "grey97"))+
# labs(fill = "TRI genotype", y = "Frequency", x = "", title = "")
#(gg <- ggplotly(p))


sd %>% 
  plot_ly(x = ~FGSC, 
         color=~TRI_genotype,
      
          colors = viridis_pal(option = "D")(3))%>% 
  layout(barmode = 'stack',
         margin=list(l=40,r=40,t=40,b=120)) %>% 
  highlight(off = "plotly_deselect")    

 #add_trace(x = ~FGSC)


```




### <i class="fa fa-bar-chart" aria-hidden="true"></i> TRI genotypes by year


```{r}

#fgsc$FGSC2 <- with(fgsc, reorder(FGSC, FGSC, function(x) length(x)))
#p<-sd %>% 
# ggplot(aes(FGSC))+
# geom_bar(aes(fill = TRI_genotype)) +
# theme_grey() +
# scale_fill_viridis(discrete = TRUE)+
# coord_flip()+
# theme(legend.position = "bottom", panel.background = element_rect(fill = "grey97"))+
# labs(fill = "TRI genotype", y = "Frequency", x = "", title = "")
#(gg <- ggplotly(p))


sd %>% 
  plot_ly(x = ~Year, 
         color=~TRI_genotype,
      
          colors = viridis_pal(option = "D")(3)) %>% 
  layout(barmode = 'stack',
         margin=list(l=40,r=40,t=40,b=140)) %>% 
  highlight(off = "plotly_deselect")    

 #add_trace(x = ~FGSC)


```



### <i class="fa fa-bar-chart" aria-hidden="true"></i> TRI genotypes by country


```{r}

#fgsc$FGSC2 <- with(fgsc, reorder(FGSC, FGSC, function(x) length(x)))
#p<-sd %>% 
# ggplot(aes(FGSC))+
# geom_bar(aes(fill = TRI_genotype)) +
# theme_grey() +
# scale_fill_viridis(discrete = TRUE)+
# coord_flip()+
# theme(legend.position = "bottom", panel.background = element_rect(fill = "grey97"))+
# labs(fill = "TRI genotype", y = "Frequency", x = "", title = "")
#(gg <- ggplotly(p))


sd %>% 
  plot_ly(x = ~Country, 
         color=~TRI_genotype,
      
          colors = viridis_pal(option = "D")(3)) %>% 
  layout(barmode = 'stack',
         margin=list(l=40,r=40,t=40,b=140)) %>% 
  highlight(off = "plotly_deselect")    

 #add_trace(x = ~FGSC)


```








<i class="fa fa-table" aria-hidden="true"></i> Full Table
=================

```{r}
datatable(fgsc, 
          extensions = c('Buttons', 'ColReorder'),
          escape = TRUE, rownames = FALSE,
         class = 'cell-border stripe',
                      options=list(dom = 'Bfrtip',buttons = c( 'excel', 'pdf'),deferRender=TRUE, 
                          scrollY=500, 
                          scroller=TRUE,
                          colReorder = TRUE,
  pageLength = 100,
    fontSize = 8,
  lengthMenu = c(100, 250, 500))) %>% 
formatStyle(c(1:19),
  fontSize = '90%')
```


About the database 
============


Column {.tabset}
----------------------------------

### About

### References


